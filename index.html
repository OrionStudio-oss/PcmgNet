<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <title>Pcmg4</title>
    

  </head>
    
  <body>
  <!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PCMGnet - Sistema Integrado</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonte Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .animate-fade-in { animation: fadeIn 0.3s ease-out; }
        .animate-slide-up { animation: slideUp 0.3s ease-out; }
    </style>

    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.292.0",
        "firebase/app": "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js",
        "firebase/firestore": "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js",
        "firebase/auth": "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js"
      }
    }
    </script>
</head>
<body class="bg-zinc-100 text-zinc-900 select-none">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import { Shield, Search, FileText, Users, Menu, X, LogOut, MapPin, Car, AlertTriangle, Plus, BarChart3, Lock, ChevronRight, Home, Siren, Gavel, CreditCard, ArrowRight, User, Scale, ClipboardList, PenTool, Archive, Trash2, Settings, ChevronUp, ChevronDown, PlusCircle, UserPlus, BookOpen } from 'lucide-react';
        import { initializeApp } from "firebase/app";
        import { getFirestore, collection, addDoc, query, where, getDocs, onSnapshot, orderBy, limit, serverTimestamp, doc, updateDoc, arrayUnion, deleteDoc, writeBatch } from "firebase/firestore";
        import { getAuth, signInAnonymously } from "firebase/auth";

        // --- CONFIGURAÇÃO ---
        const firebaseConfig = {
          apiKey: "AIzaSyD1vJwz0_j9IFVFzomH_2W4tQY3vqthzPU",
          authDomain: "atenscloud.firebaseapp.com",
          databaseURL: "https://atenscloud-default-rtdb.firebaseio.com",
          projectId: "atenscloud",
          storageBucket: "atenscloud.appspot.com",
          messagingSenderId: "779871256070",
          appId: "1:779871256070:web:4f430943f7076cd5a20d87",
          measurementId: "G-DKC83SSEVN"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        
        const LOGO_URL = "https://upload.wikimedia.org/wikipedia/commons/0/04/Recorte.png";
        const BRASAO_URL = "https://upload.wikimedia.org/wikipedia/commons/thumb/b/bf/Coat_of_arms_of_Brazil.svg/1200px-Coat_of_arms_of_Brazil.svg.png";
        const ADMIN_PASS = "PCMG-MASTER"; 

        // --- LISTAS JURÍDICAS EXPANDIDAS ---
        const CRIMES_PENAL = [
          { art: "121", desc: "Homicídio Simples" }, { art: "121 §2", desc: "Homicídio Qualificado" },
          { art: "129", desc: "Lesão Corporal" }, { art: "129 §1", desc: "Lesão Corporal Grave" },
          { art: "147", desc: "Ameaça" }, { art: "148", desc: "Sequestro / Cárcere Privado" },
          { art: "155", desc: "Furto" }, { art: "155 §4", desc: "Furto Qualificado" },
          { art: "157", desc: "Roubo (Assalto)" }, { art: "157 §2", desc: "Roubo Majorado (Arma)" },
          { art: "158", desc: "Extorsão" }, { art: "171", desc: "Estelionato" },
          { art: "180", desc: "Receptação" }, { art: "288", desc: "Associação Criminosa" },
          { art: "33", desc: "Tráfico de Drogas" }, { art: "35", desc: "Associação para o Tráfico" },
          { art: "14", desc: "Porte Ilegal de Arma (Permitido)" }, { art: "16", desc: "Porte Ilegal de Arma (Restrito)" },
          { art: "329", desc: "Resistência" }, { art: "330", desc: "Desobediência" }, 
          { art: "331", desc: "Desacato" }, { art: "342", desc: "Falso Testemunho" },
          { art: "306", desc: "Embriaguez ao Volante" }, { art: "309", desc: "Direção Perigosa" }
        ];

        const CONTRAVENCOES_TCO = [
          { art: "19 LCP", desc: "Porte de Arma Branca" },
          { art: "21 LCP", desc: "Vias de Fato (Agressão s/ Lesão)" },
          { art: "28 Lei Drogas", desc: "Posse de Drogas (Consumo)" },
          { art: "42 LCP", desc: "Perturbação do Sossego (Som Alto)" },
          { art: "50 LCP", desc: "Jogos de Azar" },
          { art: "58 LCP", desc: "Jogo do Bicho" },
          { art: "65 LCP", desc: "Perturbação da Tranquilidade" },
          { art: "309 CTB", desc: "Direção s/ Habilitação (Dano Potencial)" },
          { art: "310 CTB", desc: "Entregar Veículo a Inabilitado" }
        ];

        const PATENTES = ["Recruta", "Soldado", "Cabo", "Sargento", "Tenente", "Capitão", "Major", "Coronel", "Delegado", "Investigador", "Escrivão"];

        // ====================================================================
        // 1. COMPONENTES UI BÁSICOS
        // ====================================================================

        const ConfirmModal = ({ isOpen, title, message, onConfirm, onCancel, isDanger }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-[70] bg-black/80 flex items-center justify-center p-6 animate-fade-in">
                    <div className="bg-white rounded-xl shadow-2xl w-full max-w-sm overflow-hidden">
                        <div className={`p-4 ${isDanger ? 'bg-red-600' : 'bg-zinc-900'} text-white`}>
                            <h3 className="font-bold uppercase text-center">{title}</h3>
                        </div>
                        <div className="p-6 text-center">
                            <p className="text-zinc-600 text-sm font-medium mb-6">{message}</p>
                            <div className="flex gap-3">
                                <button onClick={onCancel} className="flex-1 py-3 bg-zinc-200 text-zinc-700 font-bold uppercase rounded-lg text-xs">Cancelar</button>
                                <button onClick={onConfirm} className={`flex-1 py-3 font-bold uppercase rounded-lg text-xs text-white ${isDanger ? 'bg-red-600' : 'bg-zinc-900'}`}>Confirmar</button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const NavButton = ({ icon, label, active, onClick }) => (
            <button onClick={onClick} className={`flex flex-col items-center justify-center w-16 transition-all ${active ? 'text-black transform -translate-y-1' : 'text-zinc-400'}`}>
                <div className={`${active ? 'bg-zinc-100 rounded-xl p-1' : ''}`}>{icon}</div>
                <span className={`text-[9px] mt-1 font-bold ${active ? 'opacity-100' : 'opacity-0'}`}>{label}</span>
            </button>
        );

        const ActionButton = ({ icon, title, desc, color, onClick }) => (
            <button onClick={onClick} className={`w-full p-6 rounded-xl shadow-md flex items-center space-x-4 transition-transform active:scale-95 ${color}`}>
                <div className="bg-white/20 p-3 rounded-full">{icon}</div>
                <div className="text-left">
                    <h4 className="font-black text-lg uppercase leading-none">{title}</h4>
                    <p className="text-[10px] font-bold uppercase opacity-80 mt-1">{desc}</p>
                </div>
                <div className="flex-1 text-right"><ArrowRight className="inline opacity-50"/></div>
            </button>
        );

        const ToolButton = ({ icon, label, onClick, color }) => (
            <button onClick={onClick} className={`w-full p-6 rounded-xl shadow-sm border border-zinc-100 flex flex-col items-center space-y-3 hover:bg-zinc-50 ${color || 'bg-white'}`}>
                <div className="bg-black/10 p-3 rounded-full text-black">{icon}</div>
                <span className="font-bold text-xs uppercase text-zinc-700">{label}</span>
            </button>
        );

        const RGCard = ({ data }) => {
            if(!data) return null;
            return (
                <div className="w-full aspect-[1.58/1] bg-green-100 rounded-xl overflow-hidden border-2 border-green-200 relative shadow-md flex flex-col">
                    <div className="bg-[url('https://www.transparenttextures.com/patterns/guilloche.png')] bg-green-200 h-1/4 w-full border-b-2 border-green-300 flex items-center justify-center relative"><div className="absolute left-2 top-2 opacity-50"><Shield size={24} className="text-green-800"/></div><div className="text-center"><h3 className="text-[10px] font-black uppercase text-green-900 tracking-widest">República Federativa do Brasil</h3><h2 className="text-xs font-black uppercase text-green-800">Carteira de Identidade Nacional</h2></div></div>
                    <div className="flex-1 p-3 flex gap-3 bg-[url('https://www.transparenttextures.com/patterns/paper.png')] relative">
                        <div className="w-1/3 bg-zinc-200 border border-zinc-300 rounded flex items-center justify-center"><Users size={32} className="text-zinc-400"/></div>
                        <div className="flex-1 space-y-2 z-10"><div><p className="text-[8px] font-bold text-green-700 uppercase">Nome Civil</p><p className="text-sm font-black text-zinc-800 uppercase leading-none">{data.nome}</p></div><div className="grid grid-cols-2 gap-2"><div><p className="text-[8px] font-bold text-green-700 uppercase">RG</p><p className="text-xs font-mono font-bold text-zinc-800">{data.rg}</p></div><div><p className="text-[8px] font-bold text-green-700 uppercase">Nascimento</p><p className="text-xs font-bold text-zinc-800">{data.nascimento}</p></div></div><div><p className="text-[8px] font-bold text-green-700 uppercase">Assinatura</p><p className="font-serif italic text-zinc-900 text-sm leading-none mt-1">{data.nome.split(' ')[0]}...</p></div></div>
                        {data.vehicles && data.vehicles.length > 0 && (<div className="absolute bottom-1 right-2 bg-yellow-100/90 border border-yellow-300 p-1.5 rounded-lg text-right shadow-sm max-w-[50%]"><p className="text-[6px] font-bold text-yellow-800 uppercase mb-0.5">Veículos Registrados</p>{data.vehicles.map((v, idx) => (<div key={idx} className="flex items-center justify-end text-[7px] font-bold text-zinc-800 leading-tight"><Car size={8} className="mr-1 text-yellow-700"/> {v.modelo} <span className="font-mono ml-1 text-zinc-500">({v.placa})</span></div>))}</div>)}
                    </div>
                </div>
            );
        };

        // --- DOCUMENTOS VISUAIS ---

        const MandadoDocument = ({ data, onSign }) => {
            const mandado = data.mandados && data.mandados.length > 0 ? data.mandados[data.mandados.length - 1] : { tipo: 'GENÉRICO', motivo: 'N/A' };
            const isIntimacao = mandado.tipo === 'Intimação';
            return (
                <div className="bg-white text-black p-8 font-serif leading-relaxed max-h-[80vh] overflow-y-auto flex flex-col">
                    <div className="text-center mb-6 border-b-2 border-black pb-4"><img src={BRASAO_URL} className="w-16 h-auto mx-auto mb-2 opacity-80" alt="Brasão"/><h2 className="font-bold text-lg uppercase">Poder Judiciário</h2><h3 className="font-bold text-sm uppercase">1º Tribunal Criminal da Comarca de MadOut</h3></div>
                    <h1 className="text-xl font-bold text-center uppercase mb-8 underline decoration-double">MANDADO DE {mandado.tipo ? mandado.tipo.toUpperCase() : 'PRISÃO'}</h1>
                    <p className="text-justify mb-4 text-sm indent-8">O <strong>MM. JUIZ DE DIREITO</strong> da 1ª Vara Criminal, no uso de suas atribuições legais,</p>
                    <p className="text-justify mb-4 text-sm indent-8"><strong>MANDA</strong> a qualquer Autoridade Policial que, em cumprimento ao presente, {isIntimacao ? "INTIME para comparecimento" : "PRENDA e RECOLHA"} a pessoa de:</p>
                    <div className="bg-zinc-50 border border-zinc-200 p-4 my-6 text-sm"><p><strong>NOME:</strong> {data.nome}</p><p><strong>RG:</strong> {data.rg || 'N/A'}</p><p className="mt-2 text-red-700"><strong>MOTIVAÇÃO:</strong> {mandado.artigo}</p></div>
                    <div className="text-center mt-4"><p className="font-bold uppercase text-lg">INTIME-SE E CUMPRA-SE.</p></div>
                    <div className="mt-8 border-t border-black w-2/3 mx-auto pt-2 text-center"><p className="italic font-serif">Juiz de Direito</p></div>
                    <button onClick={onSign} className="mt-8 w-full bg-blue-900 text-white font-sans py-3 rounded uppercase font-bold text-xs flex items-center justify-center hover:bg-blue-800"><PenTool size={14} className="mr-2"/> {isIntimacao ? "Confirmar Ciência (Assinar)" : "Assinar e Cumprir Prisão"}</button>
                </div>
            );
        };

        const BoletimDocument = ({ data }) => {
            return (
                <div className="bg-white text-black p-8 font-mono leading-relaxed max-h-[80vh] overflow-y-auto">
                    <div className="border-2 border-black p-4 mb-4">
                        <div className="flex justify-between items-center border-b border-black pb-2 mb-2">
                            <div className="text-xs font-bold">ESTADO DE MINAS GERAIS<br/>SECRETARIA DE DEFESA SOCIAL</div>
                            <div className="text-xl font-bold">BOLETIM DE OCORRÊNCIA</div>
                            <div className="text-xs text-right">PROTOCOLO<br/>{data.protocolo}</div>
                        </div>
                        <div className="grid grid-cols-2 gap-4 text-xs mb-4">
                            <div><strong>DATA:</strong> {new Date(data.data.seconds * 1000).toLocaleString()}</div>
                            <div><strong>NATUREZA:</strong> {data.natureza}</div>
                            <div><strong>AUTOR:</strong> {data.autor_fato}</div>
                            <div><strong>VÍTIMA:</strong> {data.vitima || 'A SOCIEDADE'}</div>
                        </div>
                        <div className="border border-black p-2 mb-2">
                            <p className="font-bold text-xs mb-1">RELATO FÁTICO:</p>
                            <p className="text-xs whitespace-pre-wrap">{data.relato}</p>
                        </div>
                        <div className="text-[10px] mt-4">REGISTRADO POR: {data.oficial}</div>
                    </div>
                </div>
            );
        };

        const DosimetriaDocument = ({ data }) => (
            <div className="bg-white text-black p-8 font-serif leading-relaxed max-h-[80vh] overflow-y-auto">
                <div className="text-center mb-6 border-b-2 border-black pb-4"><img src={BRASAO_URL} className="w-16 h-auto mx-auto mb-2 opacity-80" alt="Brasão"/><h2 className="font-bold text-lg uppercase">Poder Judiciário</h2><h3 className="font-bold text-sm uppercase">Vara de Execuções Penais e JECRIM</h3></div>
                <h1 className="text-xl font-bold text-center uppercase mb-6">FICHA DE ANTECEDENTES</h1>
                <div className="mb-6 text-sm"><p><strong>RÉU:</strong> {data.nome}</p><p><strong>RG:</strong> {data.rg || 'N/A'}</p></div>
                <div className="my-6">{data.historico_criminal?.map((h, i) => (<div key={i} className="mb-4 text-sm border-l-4 border-zinc-400 pl-4 py-1"><p className="font-bold uppercase">AUTOS Nº {i+1} - {h.tipo}</p><p className="font-bold text-zinc-800">INFRAÇÃO: {h.artigo}</p><p className="italic text-zinc-700 text-xs">"{h.relato || 'Sem detalhes'}"</p>{h.sentenca && <p className="mt-1 font-bold bg-zinc-100 inline-block px-1 border border-zinc-300">⚖️ {h.sentenca}</p>}<p className="text-xs text-zinc-500 mt-1">Data: {h.data}</p></div>))}</div>
                <div className="mt-16 border-t border-black w-2/3 mx-auto pt-2 text-center"><p className="italic font-serif">Escrivão Judicial</p></div>
            </div>
        );

        // --- MODAL CENTRALIZADO ---
        const DetailModal = ({ data, onClose, db, user }) => {
            const [confirmAction, setConfirmAction] = useState(null); 
            
            const archiveReds = async () => { await updateDoc(doc(db, "reds", data.id), { status: "ARQUIVADO" }); onClose(); };
            
            const signWarrant = async () => { 
                const citizenRef = doc(db, "cidadaos", data.id);
                const newStatus = data.status === "INTIMADO" ? "LIMPO" : "PRESO";
                await updateDoc(citizenRef, { 
                    status: newStatus, 
                    historico_criminal: arrayUnion({ tipo: "CUMPRIMENTO DE MANDADO", artigo: "ORDEM JUDICIAL", relato: `Mandado cumprido por ${user.nome}.`, data: new Date().toLocaleString(), oficial: user.nome }) 
                }); 
                onClose(); 
            };

            // Se for BOLETIM DE OCORRÊNCIA (Novo)
            if (data.isBoletim) {
                 return (
                    <div className="fixed inset-0 z-50 bg-black/90 flex items-center justify-center p-2 animate-fade-in" onClick={onClose}>
                        <div className="bg-white w-full max-w-lg rounded-sm shadow-2xl relative overflow-hidden" onClick={e => e.stopPropagation()}>
                            <button onClick={onClose} className="absolute top-2 right-2 text-black hover:bg-zinc-200 p-2 rounded-full z-10"><X size={24}/></button>
                            <BoletimDocument data={data} />
                        </div>
                    </div>
                );
            }

            // Se for JECRIM (Mandados e Ficha)
            if (data.isJecrim) {
                return (
                    <div className="fixed inset-0 z-50 bg-black/90 flex items-center justify-center p-2 animate-fade-in" onClick={onClose}>
                        <div className="bg-white w-full max-w-lg rounded-sm shadow-2xl relative overflow-hidden" onClick={e => e.stopPropagation()}>
                            <button onClick={onClose} className="absolute top-2 right-2 text-black hover:bg-zinc-200 p-2 rounded-full z-10"><X size={24}/></button>
                            {(data.jecrimType === 'procurados' || data.status === 'PROCURADO' || data.status === 'INTIMADO') ? 
                                <MandadoDocument data={data} onSign={() => setConfirmAction({type:'sign', msg: 'Confirmar cumprimento?'})} /> 
                                : <DosimetriaDocument data={data} />
                            }
                        </div>
                        <ConfirmModal isOpen={!!confirmAction} title="Confirmar Ação" message={confirmAction?.msg} onConfirm={confirmAction?.type === 'sign' ? signWarrant : archiveReds} onCancel={() => setConfirmAction(null)} />
                    </div>
                );
            }

            // Se for REDS (Padrão)
            return (
                <div className="fixed inset-0 z-50 bg-black/80 flex items-center justify-center p-4 animate-fade-in" onClick={onClose}><div className="bg-white w-full max-w-sm rounded-2xl overflow-hidden shadow-2xl" onClick={e => e.stopPropagation()}><div className="bg-zinc-900 p-4 text-white flex justify-between items-center"><h3 className="font-bold uppercase text-sm">REDS {data.protocolo}</h3><button onClick={onClose}><X size={18}/></button></div><div className="p-6 space-y-4 max-h-[80vh] overflow-y-auto"><div><p className="text-[10px] font-bold text-zinc-400 uppercase">Natureza</p><p className="font-black text-xl text-zinc-800 uppercase">{data.natureza}</p></div><div><p className="text-[10px] font-bold text-zinc-400 uppercase">Local</p><p className="font-bold text-zinc-800 uppercase">{data.local}</p></div><div className="bg-zinc-50 p-3 rounded border text-xs uppercase text-zinc-600"><p className="font-bold mb-1">Histórico:</p> {data.relato || "Sem relato adicional."}</div>{data.status === 'ABERTO' && (<button onClick={() => setConfirmAction({type: 'archive', msg: 'Arquivar esta ocorrência?'})} className="w-full mt-4 bg-zinc-200 text-zinc-600 py-3 rounded-xl font-bold uppercase text-xs hover:bg-zinc-300 flex items-center justify-center"><Archive size={16} className="mr-2"/> Arquivar Ocorrência</button>)}</div></div><ConfirmModal isOpen={!!confirmAction} title="Confirmar" message={confirmAction?.msg} onConfirm={confirmAction?.type === 'sign' ? signWarrant : archiveReds} onCancel={() => setConfirmAction(null)} /></div>
            );
        };

        // --- VIEWS ---

        const ToolsView = ({ db, user, onNavigate }) => {
            const [view, setView] = useState('menu');
            const [nome, setNome] = useState('');
            const [placa, setPlaca] = useState('');
            const [modelo, setModelo] = useState('');
            const [prop, setProp] = useState('');

            // Estado para BO
            const [boStep, setBoStep] = useState('search'); 
            const [boTarget, setBoTarget] = useState('');
            const [boData, setBoData] = useState(null);
            const [boForm, setBoForm] = useState({ natureza: '', local: '', relato: '', vitima: '' });

            const registerCIN = async () => { if(!nome) return; const rgNum = `${Math.floor(Math.random()*99)}.${Math.floor(Math.random()*999)}.${Math.floor(Math.random()*999)}-${Math.floor(Math.random()*999)}`; await addDoc(collection(db, "cidadaos"), { nome: nome.toUpperCase(), rg: rgNum, status: 'LIMPO', historico_criminal: [], mandados: [], multas: [], createdAt: serverTimestamp() }); alert(`RG Gerado: ${rgNum}`); setView('menu'); setNome(''); };
            const registerCar = async () => { if(!placa || !prop) return; await addDoc(collection(db, "veiculos"), { placa: placa.toUpperCase(), modelo: modelo.toUpperCase(), proprietario: prop.toUpperCase(), status: 'REGULAR', createdAt: serverTimestamp() }); alert("Veículo registrado."); setView('menu'); setPlaca(''); setProp(''); };
            
            // Lógica BO
            const searchBoAutor = async (e) => {
                e.preventDefault();
                if(!boTarget) return;
                const term = boTarget.toUpperCase();
                const q = query(collection(db, "cidadaos"), where("nome", ">=", term), where("nome", "<=", term + '\uf8ff'));
                const snap = await getDocs(q);
                if (snap.empty) {
                    if(confirm(`Cidadão "${term}" não encontrado. Criar RG agora?`)) setBoStep('register_rg');
                } else {
                    setBoData({ id: snap.docs[0].id, ...snap.docs[0].data() });
                    setBoStep('form');
                }
            };

            const saveBO = async () => {
                if(!boData) return;
                const protocolo = `BO-${Math.floor(Math.random()*100000)}`;
                // Salva na coleção 'boletins' (pode ser útil para consulta futura se implementado)
                await addDoc(collection(db, "boletins"), { ...boForm, autor_fato: boData.nome, oficial: user.nome, data: serverTimestamp(), protocolo });
                // Salva no histórico do cidadão
                const crimeRef = { tipo: 'BOLETIM DE OCORRÊNCIA', artigo: boForm.natureza, relato: boForm.relato, data: new Date().toLocaleString(), oficial: user.nome, sentenca: `Protocolo: ${protocolo}` };
                await updateDoc(doc(db, "cidadaos", boData.id), { historico_criminal: arrayUnion(crimeRef) });
                alert(`BO ${protocolo} Registrado.`); setView('menu');
            };

            if(view === 'menu') return (
                <div className="grid grid-cols-1 gap-4 animate-slide-up">
                    <h3 className="font-bold uppercase text-zinc-500 ml-1">Ferramentas Administrativas</h3>
                    <ToolButton icon={<FileText size={32}/>} label="Registrar Boletim de Ocorrência (B.O.)" onClick={() => setView('bo')} color="bg-zinc-800 text-white" />
                    <div className="grid grid-cols-2 gap-4">
                        <ToolButton icon={<UserPlus size={32}/>} label="Emitir CIN" onClick={() => setView('cin')} color="bg-white text-zinc-800" />
                        <ToolButton icon={<Car size={32}/>} label="Emplacar" onClick={() => setView('car')} color="bg-white text-zinc-800" />
                    </div>
                </div>
            );

            if (view === 'bo') {
                if(boStep === 'search') return (<div className="bg-white p-6 rounded-2xl shadow-sm space-y-4 animate-fade-in"><div className="flex justify-between items-center"><h3 className="font-black uppercase">Novo B.O.</h3><button onClick={()=>setView('menu')}><X size={20}/></button></div><p className="text-xs text-zinc-500 uppercase">Envolvido / Autor do Fato</p><form onSubmit={searchBoAutor} className="space-y-4"><input value={boTarget} onChange={e=>setBoTarget(e.target.value)} className="w-full bg-zinc-50 p-4 rounded-xl border border-zinc-200 uppercase font-bold" placeholder="NOME DO CIDADÃO" autoFocus /><button className="w-full bg-black text-white py-4 rounded-xl font-bold uppercase">Buscar Cadastro</button></form></div>);
                if(boStep === 'register_rg') return <RGGenerator initialName={boTarget} onRegister={async (d) => { const ref = await addDoc(collection(db, "cidadaos"), d); setBoData({id: ref.id, ...d}); setBoStep('form'); }} onCancel={() => setBoStep('search')} />;
                if(boStep === 'form') return (
                    <div className="bg-white p-6 rounded-2xl shadow-sm space-y-4 animate-slide-up">
                        <div className="flex justify-between items-center"><h3 className="font-black uppercase">Boletim de Ocorrência</h3><button onClick={()=>setView('menu')}><X size={20}/></button></div>
                        <RGCard data={boData} />
                        <input className="w-full bg-zinc-50 p-3 rounded border uppercase text-xs font-bold" placeholder="Natureza do Fato (Ex: Extravio)" onChange={e=>setBoForm({...boForm, natureza: e.target.value})} />
                        <input className="w-full bg-zinc-50 p-3 rounded border uppercase text-xs font-bold" placeholder="Vítima (Opcional)" onChange={e=>setBoForm({...boForm, vitima: e.target.value})} />
                        <input className="w-full bg-zinc-50 p-3 rounded border uppercase text-xs font-bold" placeholder="Local" onChange={e=>setBoForm({...boForm, local: e.target.value})} />
                        <textarea className="w-full bg-zinc-50 p-3 rounded border uppercase text-xs h-32" placeholder="Relato Fático..." onChange={e=>setBoForm({...boForm, relato: e.target.value})} />
                        <button onClick={saveBO} className="w-full bg-blue-800 text-white py-4 rounded-xl font-bold uppercase text-sm">Registrar B.O.</button>
                    </div>
                );
            }

            if (view === 'cin') return (<div className="bg-white p-6 rounded-2xl shadow-sm space-y-4 animate-slide-up"><div className="flex justify-between items-center"><h3 className="font-bold uppercase">Registro Civil (CIN)</h3><button onClick={()=>setView('menu')}><X size={20}/></button></div><input value={nome} onChange={e=>setNome(e.target.value)} className="w-full bg-zinc-50 p-3 rounded border uppercase text-sm" placeholder="Nome Completo" /><button onClick={registerCIN} className="w-full bg-black text-white py-3 rounded font-bold uppercase text-sm">Registrar Identidade</button></div>);
            if (view === 'car') return (<div className="bg-white p-6 rounded-2xl shadow-sm space-y-4 animate-slide-up"><div className="flex justify-between items-center"><h3 className="font-bold uppercase">Emplacamento</h3><button onClick={()=>setView('menu')}><X size={20}/></button></div><input value={placa} onChange={e=>setPlaca(e.target.value)} className="w-full bg-zinc-50 p-3 rounded border uppercase text-sm" placeholder="Placa (XXX-0000)" /><input value={modelo} onChange={e=>setModelo(e.target.value)} className="w-full bg-zinc-50 p-3 rounded border uppercase text-sm" placeholder="Modelo" /><input value={prop} onChange={e=>setProp(e.target.value)} className="w-full bg-zinc-50 p-3 rounded border uppercase text-sm" placeholder="Nome Proprietário" /><button onClick={registerCar} className="w-full bg-blue-600 text-white py-3 rounded font-bold uppercase text-sm">Registrar Veículo</button></div>);
            return null;
        };

        const HomeView = ({ db, openDetails, onNavigate }) => {
            const [reds, setReds] = useState([]);
            const [showArchived, setShowArchived] = useState(false);
            useEffect(() => {
                const statusFilter = showArchived ? "ARQUIVADO" : "ABERTO";
                const q = query(collection(db, "reds"), where("status", "==", statusFilter), limit(20));
                const unsub = onSnapshot(q, (snap) => {
                    const docs = snap.docs.map(d => ({id: d.id, ...d.data()}));
                    docs.sort((a,b) => b.data?.seconds - a.data?.seconds); setReds(docs);
                });
                return () => unsub();
            }, [db, showArchived]);

            return (
                <div className="space-y-4">
                    <div className="flex justify-between items-center"><h3 className="font-bold text-lg text-zinc-800 border-l-4 border-red-600 pl-3 uppercase">{showArchived ? "Arquivo Morto" : "Ocorrências Ativas"}</h3><button onClick={() => setShowArchived(!showArchived)} className={`text-[10px] font-bold uppercase px-3 py-1 rounded-full border ${showArchived ? 'bg-zinc-800 text-white border-zinc-800' : 'bg-white text-zinc-500 border-zinc-300'}`}>{showArchived ? "Ver Ativas" : "Ver Histórico"}</button></div>
                    {!showArchived && (<div className="grid grid-cols-2 gap-3"><button onClick={() => onNavigate('jecrim')} className="w-full bg-zinc-900 text-white p-4 rounded-2xl shadow-lg flex flex-col justify-center border-l-4 border-yellow-500"><div className="flex items-center mb-2"><Scale size={20} className="text-yellow-500 mr-2"/><span className="font-black uppercase text-sm">JECRIM</span></div><p className="text-[10px] text-zinc-400">Procurados</p></button><button onClick={() => onNavigate('tco')} className="w-full bg-white text-zinc-900 p-4 rounded-2xl shadow-sm border border-zinc-200 flex flex-col justify-center border-l-4 border-blue-500"><div className="flex items-center mb-2"><ClipboardList size={20} className="text-blue-500 mr-2"/><span className="font-black uppercase text-sm">Novo TCO</span></div><p className="text-[10px] text-zinc-400">Termo Circunst.</p></button></div>)}
                    <div className="space-y-3 pb-20">{reds.length === 0 && <p className="text-center text-zinc-400 py-10">Nenhum registro encontrado.</p>}{reds.map(r => (<div key={r.id} onClick={() => openDetails(r)} className={`bg-white p-4 rounded-xl shadow-sm border-l-4 active:scale-[0.99] transition-transform cursor-pointer ${showArchived ? 'border-zinc-400 opacity-70' : 'border-red-600'}`}><div className="flex justify-between items-start mb-2"><span className="text-[10px] font-bold bg-zinc-100 text-zinc-600 px-2 py-1 rounded">{r.protocolo}</span><span className={`text-[10px] font-bold uppercase flex items-center ${showArchived ? 'text-zinc-500' : 'text-red-600'}`}>{r.status}</span></div><h4 className="font-bold text-zinc-900 uppercase">{r.natureza}</h4><p className="text-sm text-zinc-500 mt-1 flex items-center uppercase"><MapPin size={14} className="mr-1 text-zinc-400" />{r.local}</p></div>))}</div>
                </div>
            );
        };

        const TcoView = ({ db, user, onSuccess }) => {
            const [tcoStep, setTcoStep] = useState('search'); 
            const [tcoTarget, setTcoTarget] = useState('');
            const [tcoData, setTcoData] = useState(null);
            const [tcoForm, setTcoForm] = useState({ vitima: '', relato: '', artigo: '', local: '' });
            const [confirmTco, setConfirmTco] = useState(false);
            const searchTcoAutor = async (e) => { e.preventDefault(); if(!tcoTarget) return; const term = tcoTarget.toUpperCase(); const q = query(collection(db, "cidadaos"), where("nome", ">=", term), where("nome", "<=", term + '\uf8ff')); const snap = await getDocs(q); if (snap.empty) { if(confirm(`Autor "${term}" não encontrado. Cadastrar agora?`)) setTcoStep('register_rg'); } else { setTcoData({ id: snap.docs[0].id, ...snap.docs[0].data() }); setTcoStep('form'); } };
            const saveTCO = async () => { if(!tcoData) return; const protocol = `TCO-${Math.floor(Math.random()*1000)}`; const multaValor = Math.floor(Math.random() * (2000 - 500 + 1) + 500); await addDoc(collection(db, "tcos"), { ...tcoForm, autor_fato: tcoData.nome, autor_id: tcoData.id, oficial: user.nome, data: serverTimestamp(), protocol, sentenca: `Multa de R$ ${multaValor}` }); const crimeRef = { tipo: 'TCO (INFRAÇÃO MENOR)', artigo: tcoForm.artigo, relato: tcoForm.relato, data: new Date().toLocaleString(), oficial: user.nome, sentenca: `Transação Penal: Multa de R$ ${multaValor}` }; await updateDoc(doc(db, "cidadaos", tcoData.id), { historico_criminal: arrayUnion(crimeRef) }); alert(`TCO Lavrado. Multa R$ ${multaValor}.`); onSuccess(); };
            if(tcoStep === 'search') return (<div className="bg-white p-6 rounded-2xl shadow-sm space-y-4 animate-fade-in"><div className="flex justify-between items-center"><h3 className="font-black uppercase">Novo T.C.O.</h3></div><p className="text-xs text-zinc-500 uppercase">Identifique o Autor do Fato</p><form onSubmit={searchTcoAutor} className="space-y-4"><input value={tcoTarget} onChange={e=>setTcoTarget(e.target.value)} className="w-full bg-zinc-50 p-4 rounded-xl border border-zinc-200 uppercase font-bold" placeholder="NOME DO AUTOR" autoFocus /><button className="w-full bg-black text-white py-4 rounded-xl font-bold uppercase">Buscar Cadastro</button></form></div>);
            if(tcoStep === 'register_rg') return <RGGenerator initialName={tcoTarget} onRegister={async (d) => { const ref = await addDoc(collection(db, "cidadaos"), d); setTcoData({id: ref.id, ...d}); setTcoStep('form'); }} onCancel={() => setTcoStep('search')} />;
            if(tcoStep === 'form') return (<div className="bg-white p-6 rounded-2xl shadow-sm space-y-4 animate-slide-up"><RGCard data={tcoData} /><div className="border-t pt-4"><input className="w-full bg-zinc-50 p-3 rounded border border-zinc-300 uppercase text-xs font-bold mb-3" placeholder="Vítima (Opcional)" onChange={e=>setTcoForm({...tcoForm, vitima: e.target.value})} /><input className="w-full bg-zinc-50 p-3 rounded border border-zinc-300 uppercase text-xs font-bold mb-3" placeholder="Local do Fato" onChange={e=>setTcoForm({...tcoForm, local: e.target.value})} /><select className="w-full bg-zinc-50 p-3 rounded border border-zinc-300 uppercase text-xs font-bold mb-3" onChange={e=>setTcoForm({...tcoForm, artigo: e.target.value})}><option value="">Artigo...</option>{CONTRAVENCOES_TCO.map(c => <option key={c.art} value={`${c.art} - ${c.desc}`}>{c.art} - {c.desc}</option>)}</select><textarea className="w-full bg-zinc-50 p-3 rounded border border-zinc-300 uppercase text-xs h-24 mb-3" placeholder="Narrativa..." onChange={e=>setTcoForm({...tcoForm, relato: e.target.value})} /><div className="bg-yellow-50 p-3 rounded border border-yellow-200 text-[10px] text-yellow-800 font-bold uppercase text-center mb-4">⚠️ Multa automática 500-2000 moedas.</div><button onClick={()=>setConfirmTco(true)} className="w-full bg-black text-white py-4 rounded-xl font-bold uppercase text-sm">Lavrar Termo</button></div><ConfirmModal isOpen={confirmTco} title="Confirmar TCO" message="Deseja lavrar o termo e aplicar a multa?" onConfirm={saveTCO} onCancel={() => setConfirmTco(false)} /></div>);
            return null;
        };

        const OperationalView = ({ db, user, onSuccess }) => {
            const [mode, setMode] = useState('menu');
            const [actionType, setActionType] = useState(null);
            const [targetName, setTargetName] = useState('');
            const [targetData, setTargetData] = useState(null);
            const [formData, setFormData] = useState({ artigo: '', relato: '', valor: '', tipoMandado: '' });
            const [showConfirm, setShowConfirm] = useState(false);
            const startAction = async (e) => { e.preventDefault(); if(!targetName) return; const term = targetName.toUpperCase(); const q = query(collection(db, "cidadaos"), where("nome", ">=", term), where("nome", "<=", term + '\uf8ff')); const snap = await getDocs(q); if (snap.empty) { if(confirm(`Cidadão "${term}" não possui RG. Cadastrar agora?`)) setMode('rg_register'); } else { setTargetData({ id: snap.docs[0].id, ...snap.docs[0].data() }); setMode('action_form'); } };
            const executeAction = async () => { if(!targetData) return; const docRef = doc(db, "cidadaos", targetData.id); const timestamp = new Date().toLocaleString(); let updateData = {}; if (actionType === 'flagrante') { const crime = { tipo: 'PRISÃO EM FLAGRANTE', artigo: formData.artigo, relato: formData.relato, data: timestamp, oficial: user.nome }; updateData = { historico_criminal: arrayUnion(crime) }; } else if (actionType === 'mandado') { const status = formData.tipoMandado === 'Intimação' ? 'INTIMADO' : 'PROCURADO'; const mandado = { tipo: formData.tipoMandado, artigo: formData.artigo, motivo: formData.relato, data: timestamp, oficial: user.nome, status: status }; updateData = { mandados: arrayUnion(mandado), status: status }; } else if (actionType === 'multa') { const multa = { valor: formData.valor, motivo: formData.relato, data: timestamp, oficial: user.nome }; updateData = { multas: arrayUnion(multa) }; } await updateDoc(docRef, updateData); setShowConfirm(false); alert("AÇÃO REGISTRADA."); onSuccess(); };
            
            if (mode === 'menu') return (<div className="space-y-4 animate-slide-up"><h3 className="font-bold text-lg text-zinc-800 border-l-4 border-black pl-3 uppercase">Painel Tático</h3><div className="grid grid-cols-1 gap-4"><ActionButton icon={<Siren size={32} className="text-white"/>} title="Prisão em Flagrante" desc="Registra crime na ficha." color="bg-red-600 text-white" onClick={() => { setActionType('flagrante'); setMode('search_target'); }} /><ActionButton icon={<Gavel size={32} className="text-white"/>} title="Expedir Mandado" desc="Prisão ou Intimação." color="bg-zinc-800 text-white" onClick={() => { setActionType('mandado'); setMode('search_target'); }} /><ActionButton icon={<CreditCard size={32} className="text-zinc-800"/>} title="Aplicar Multa" desc="Sanções administrativas." color="bg-yellow-400 text-zinc-900" onClick={() => { setActionType('multa'); setMode('search_target'); }} /></div></div>);
            if (mode === 'search_target') return (<div className="bg-white p-6 rounded-2xl shadow-sm space-y-4 animate-fade-in"><div className="flex justify-between items-center mb-2"><h3 className="font-bold uppercase text-lg">Identificar Alvo</h3><button onClick={()=>setMode('menu')}><X size={20}/></button></div><form onSubmit={startAction} className="space-y-4"><input value={targetName} onChange={e=>setTargetName(e.target.value)} className="w-full bg-zinc-50 p-4 rounded-xl border border-zinc-200 uppercase font-bold" placeholder="NOME COMPLETO" autoFocus /><button className="w-full bg-black text-white py-4 rounded-xl font-bold uppercase">Verificar Base de Dados</button></form></div>);
            if (mode === 'rg_register') return <RGGenerator initialName={targetName} onRegister={async (d) => { const ref = await addDoc(collection(db, "cidadaos"), d); setTargetData({id: ref.id, ...d}); setMode('action_form'); }} onCancel={() => setMode('menu')} />;
            if (mode === 'action_form') return (<div className="space-y-4 animate-slide-up"><RGCard data={targetData} /><div className="bg-white p-6 rounded-2xl shadow-sm space-y-4"><h3 className="font-black uppercase text-lg border-b pb-2">{actionType === 'flagrante' ? 'REGISTRO DE FLAGRANTE' : (actionType === 'mandado' ? 'EXPEDIÇÃO DE MANDADO' : 'APLICAÇÃO DE MULTA')}</h3>{actionType !== 'multa' && (<div><label className="text-[10px] font-bold text-zinc-500 uppercase">Enquadramento</label><select className="w-full bg-zinc-50 p-3 rounded border font-bold uppercase text-sm mt-1" onChange={e => setFormData({...formData, artigo: e.target.value})}><option value="">Selecione o Artigo...</option>{CRIMES_PENAL.map(c => <option key={c.art} value={`${c.art} - ${c.desc}`}>{c.art} - {c.desc}</option>)}</select></div>)}{actionType === 'mandado' && (<div><label className="text-[10px] font-bold text-zinc-500 uppercase">Tipo de Ordem</label><select className="w-full bg-zinc-50 p-3 rounded border font-bold uppercase text-sm mt-1" onChange={e => setFormData({...formData, tipoMandado: e.target.value})}><option>Prisão Preventiva</option><option>Busca e Apreensão</option><option>Intimação</option></select></div>)}{actionType === 'multa' && <input placeholder="VALOR R$" type="number" className="w-full bg-zinc-50 p-3 rounded border font-bold uppercase text-sm" onChange={e => setFormData({...formData, valor: e.target.value})} />}<textarea placeholder="RELATO DETALHADO DO FATO..." className="w-full bg-zinc-50 p-3 rounded border uppercase text-sm h-32" onChange={e => setFormData({...formData, relato: e.target.value})}></textarea><button onClick={() => setShowConfirm(true)} className={`w-full text-white py-4 rounded-xl font-black uppercase shadow-lg ${actionType === 'flagrante' ? 'bg-red-600' : 'bg-black'}`}>CONFIRMAR PROCESSO</button><button onClick={()=>setMode('menu')} className="w-full text-zinc-500 py-2 text-xs font-bold uppercase">Cancelar</button></div><ConfirmModal isOpen={showConfirm} title="Confirmar Ação" message="Deseja oficializar este registro no sistema?" onConfirm={executeAction} onCancel={() => setShowConfirm(false)} /></div>);
            return null;
        };

        const JecrimView = ({ db, openDetails, onBack }) => {
            const [tab, setTab] = useState('procurados');
            const [list, setList] = useState([]);
            useEffect(() => {
                let q = query(collection(db, "cidadaos"), orderBy("nome"), limit(50));
                const unsub = onSnapshot(q, (snap) => {
                    let data = snap.docs.map(d => ({id: d.id, ...d.data()}));
                    if (tab === 'procurados') { data = data.filter(c => c.status === 'PROCURADO' || c.status === 'INTIMADO'); } 
                    else { data = data.filter(c => c.historico_criminal && c.historico_criminal.length > 0); }
                    setList(data);
                });
                return () => unsub();
            }, [db, tab]);
            return (
                <div className="space-y-4 animate-slide-up">
                    <div className="flex items-center space-x-2 border-b pb-4"><button onClick={onBack}><ChevronRight className="rotate-180 text-zinc-500"/></button><h2 className="font-black text-2xl text-zinc-900 uppercase">JECRIM</h2></div>
                    <div className="flex bg-zinc-200 p-1 rounded-lg">
                        <button onClick={() => setTab('procurados')} className={`flex-1 py-2 text-xs font-bold uppercase rounded-md ${tab === 'procurados' ? 'bg-red-600 text-white shadow-sm' : 'text-zinc-500'}`}>Mandados</button>
                        <button onClick={() => setTab('processados')} className={`flex-1 py-2 text-xs font-bold uppercase rounded-md ${tab === 'processados' ? 'bg-zinc-800 text-white shadow-sm' : 'text-zinc-500'}`}>Processados</button>
                    </div>
                    <div className="space-y-3 pb-20">
                        {list.length === 0 && <p className="text-center text-zinc-400 py-10">Nenhum registro.</p>}
                        {list.map(c => (
                            <div key={c.id} onClick={() => openDetails({...c, isJecrim: true, jecrimType: tab})} className={`bg-white p-4 rounded-xl shadow-sm border-l-4 cursor-pointer ${tab === 'procurados' ? (c.status === 'INTIMADO' ? 'border-yellow-500' : 'border-red-600') : 'border-zinc-800'}`}>
                                <h3 className="font-black text-lg uppercase">{c.nome}</h3>
                                <p className="text-xs text-zinc-500 font-mono">CIN: {c.rg || 'N/A'}</p>
                                {tab === 'procurados' && c.mandados && c.mandados.length > 0 && (
                                    <div className={`mt-2 text-[10px] font-bold uppercase ${c.status === 'INTIMADO' ? 'text-yellow-600' : 'text-red-600'}`}>
                                        ⚠️ {c.mandados[c.mandados.length-1].tipo} - {c.mandados[c.mandados.length-1].artigo || 'N/A'}
                                    </div>
                                )}
                                {tab === 'processados' && <div className="mt-2 text-[10px] font-bold text-zinc-600 uppercase">⚖️ {c.historico_criminal.length} Processos / TCOs</div>}
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        const RedsView = ({ db, user, onSuccess }) => {
            const [form, setForm] = useState({ natureza: '', local: '', envolvidos: '', vitimas: '', objetos: '', relato: '' });
            const save = async (e) => { e.preventDefault(); const protocolo = `REDS-${Math.floor(Math.random()*10000)}`; await addDoc(collection(db, "reds"), { ...form, protocolo, data: serverTimestamp(), autor: user.nome, status: 'ABERTO' }); alert("Ocorrência registrada."); onSuccess(); };
            return (<form onSubmit={save} className="bg-white p-6 rounded-2xl shadow-sm space-y-4 animate-slide-up"><h3 className="font-black uppercase text-center">Registro de Evento (REDS)</h3><input className="w-full bg-zinc-50 p-3 rounded border uppercase text-xs font-bold" placeholder="Natureza Principal" onChange={e=>setForm({...form, natureza: e.target.value})} required /><input className="w-full bg-zinc-50 p-3 rounded border uppercase text-xs font-bold" placeholder="Local do Fato" onChange={e=>setForm({...form, local: e.target.value})} required /><input className="w-full bg-zinc-50 p-3 rounded border uppercase text-xs font-bold" placeholder="Envolvidos (Autores)" onChange={e=>setForm({...form, envolvidos: e.target.value})} /><input className="w-full bg-zinc-50 p-3 rounded border uppercase text-xs font-bold" placeholder="Vítimas" onChange={e=>setForm({...form, vitimas: e.target.value})} /><textarea className="w-full bg-zinc-50 p-3 rounded border uppercase text-xs h-20" placeholder="Objetos Apreendidos..." onChange={e=>setForm({...form, objetos: e.target.value})} /><textarea className="w-full bg-zinc-50 p-3 rounded border uppercase text-xs h-32" placeholder="Relato Detalhado..." onChange={e=>setForm({...form, relato: e.target.value})} /><button className="w-full bg-red-700 text-white py-4 rounded-xl font-bold uppercase"><PlusCircle size={20} className="inline mr-2"/> Transmitir REDS</button></form>);
        };

        const SearchView = ({ db }) => {
            const [mode, setMode] = useState('menu');
            const [term, setTerm] = useState('');
            const [results, setResults] = useState(null); 
            const [selectedItem, setSelectedItem] = useState(null); 
            const [loading, setLoading] = useState(false);
            const [deleteConfirm, setDeleteConfirm] = useState(null); 
            const handleDelete = async () => { if(deleteConfirm) { await deleteDoc(doc(db, deleteConfirm.col, deleteConfirm.id)); setSelectedItem(null); setTerm(''); setDeleteConfirm(null); setResults(null); } };
            const searchPerson = async (e) => { e.preventDefault(); if(!term) return; setLoading(true); setResults(null); setSelectedItem(null); try { const searchTerm = term.toUpperCase(); const q = query(collection(db, "cidadaos"), where("nome", ">=", searchTerm), where("nome", "<=", searchTerm + '\uf8ff')); const snap = await getDocs(q); if (!snap.empty) { const people = snap.docs.map(doc => ({id: doc.id, ...doc.data()})); setResults(people); } else { setResults([]); } } catch(e) { alert("Erro ao buscar"); } setLoading(false); };
            const fetchPersonDetails = async (person) => { try { const vQ = query(collection(db, "veiculos"), where("proprietario", "==", person.nome)); const vSnap = await getDocs(vQ); const vehicles = vSnap.docs.map(d => d.data()); setSelectedItem({...person, vehicles}); } catch (e) { setSelectedItem(person); } };
            const searchCar = async (e) => { e.preventDefault(); if(!term) return; setLoading(true); setResults(null); setSelectedItem(null); try { const q = query(collection(db, "veiculos"), where("placa", "==", term.toUpperCase())); const snap = await getDocs(q); if (!snap.empty) { setSelectedItem({id: snap.docs[0].id, ...snap.docs[0].data(), isVehicle: true}); } else { setResults([]); } } catch(e) { alert("Erro"); } setLoading(false); };
            if (mode === 'menu') return (<div className="space-y-4 animate-slide-up"><div className="flex items-center space-x-2 border-b pb-4 mb-2"><h2 className="font-black text-xl text-zinc-900 uppercase">Central de Pesquisa</h2></div><div className="grid grid-cols-1 gap-4"><button onClick={() => setMode('person')} className="bg-white p-6 rounded-2xl shadow-sm border border-zinc-200 flex items-center space-x-4 hover:bg-zinc-50 transition-colors"><div className="bg-zinc-100 p-4 rounded-full"><Users size={32} className="text-zinc-700"/></div><div className="text-left"><h3 className="font-black text-lg uppercase text-zinc-800">Cidadãos</h3><p className="text-[10px] uppercase text-zinc-500">Consultar Antecedentes e Vínculos</p></div><div className="flex-1 text-right"><ChevronRight className="inline text-zinc-300"/></div></button><button onClick={() => setMode('car')} className="bg-white p-6 rounded-2xl shadow-sm border border-zinc-200 flex items-center space-x-4 hover:bg-zinc-50 transition-colors"><div className="bg-zinc-100 p-4 rounded-full"><Car size={32} className="text-zinc-700"/></div><div className="text-left"><h3 className="font-black text-lg uppercase text-zinc-800">Veículos</h3><p className="text-[10px] uppercase text-zinc-500">Consultar Placa e Proprietário</p></div><div className="flex-1 text-right"><ChevronRight className="inline text-zinc-300"/></div></button></div></div>);
            if (mode === 'person') return (<div className="space-y-4 animate-fade-in relative">{deleteConfirm && (<div className="absolute inset-0 z-50 bg-white/90 flex items-center justify-center p-4"><div className="bg-white border-2 border-red-500 p-6 rounded-xl shadow-xl text-center"><h4 className="font-black text-red-600 uppercase mb-2">Apagar Registro?</h4><div className="flex gap-2"><button onClick={() => setDeleteConfirm(null)} className="flex-1 bg-zinc-200 py-2 rounded text-xs font-bold uppercase">Cancelar</button><button onClick={handleDelete} className="flex-1 bg-red-600 text-white py-2 rounded text-xs font-bold uppercase">Apagar</button></div></div></div>)}<div className="flex items-center justify-between"><h3 className="font-bold uppercase text-zinc-500 text-xs">Consulta Nominal</h3><button onClick={() => {setMode('menu'); setResults(null); setSelectedItem(null); setTerm('');}} className="text-zinc-400 bg-white p-1 rounded-full border"><X size={16}/></button></div><form onSubmit={searchPerson} className="bg-white p-2 rounded-xl shadow-sm border border-zinc-200 flex items-center"><Search size={20} className="text-zinc-400 ml-3" /><input value={term} onChange={e=>setTerm(e.target.value)} className="flex-1 bg-transparent p-3 outline-none text-zinc-800 placeholder-zinc-400 font-medium uppercase" placeholder="NOME COMPLETO" autoFocus /><button className="bg-black text-white px-4 py-2 rounded-lg text-xs font-bold uppercase">{loading ? '...' : 'BUSCAR'}</button></form>{results && results.length === 0 && <div className="text-center text-zinc-400 text-sm py-10">Nenhum cidadão encontrado.</div>}{results && results.length > 0 && !selectedItem && (<div className="space-y-2 animate-slide-up"><p className="text-xs text-zinc-500 uppercase ml-1">Resultados: {results.length}</p>{results.map(r => (<div key={r.id} onClick={() => fetchPersonDetails(r)} className="bg-white p-4 rounded-xl border border-zinc-200 flex justify-between items-center cursor-pointer hover:bg-zinc-50"><div><h4 className="font-bold uppercase text-zinc-800">{r.nome}</h4><p className="text-xs text-zinc-500 font-mono">CIN: {r.rg || 'N/A'}</p></div><ChevronRight size={16} className="text-zinc-300"/></div>))}</div>)}{selectedItem && (<div className="space-y-4 animate-slide-up"><div className="flex justify-end space-x-2"><button onClick={() => setSelectedItem(null)} className="text-[10px] bg-zinc-200 text-zinc-600 px-3 py-1 rounded-full uppercase font-bold flex items-center hover:bg-zinc-300">Voltar</button><button onClick={() => setDeleteConfirm({col: 'cidadaos', id: selectedItem.id})} className="text-[10px] bg-red-100 text-red-700 px-3 py-1 rounded-full uppercase font-bold flex items-center hover:bg-red-200"><Trash2 size={12} className="mr-1"/> Excluir Ficha</button></div><RGCard data={selectedItem} /><div className="bg-white rounded-xl shadow-sm overflow-hidden"><div className="bg-zinc-100 p-3 border-b flex justify-between items-center"><span className="font-bold uppercase text-xs">Status Jurídico</span><span className={`px-2 py-1 rounded text-[10px] font-black uppercase text-white ${selectedItem.status === 'PROCURADO' ? 'bg-red-600' : (selectedItem.status === 'INTIMADO' ? 'bg-yellow-500' : 'bg-green-600')}`}>{selectedItem.status}</span></div><div className="p-4 space-y-4">{selectedItem.mandados?.length > 0 && <div className="bg-red-50 p-3 rounded border border-red-100"><h4 className="font-bold text-xs uppercase text-red-800 mb-2">Mandados em Aberto</h4>{selectedItem.mandados.map((m,i) => <div key={i} className="text-[10px] text-red-700 font-bold mb-1">⚠️ {m.tipo} - {m.artigo}</div>)}</div>}<div><h4 className="font-bold text-xs uppercase text-zinc-500 mb-2">Multas</h4>{(!selectedItem.multas || selectedItem.multas.length === 0) && <p className="text-xs text-zinc-300">Nenhuma multa.</p>}{selectedItem.multas?.map((m, i) => (<div key={i} className="text-xs border-l-2 border-yellow-400 pl-2 mb-1"><span className="font-bold block text-zinc-800">R$ {m.valor}</span><span className="text-[10px] text-zinc-500">{m.motivo || 'Infração de Trânsito'}</span></div>))}</div><div><h4 className="font-bold text-xs uppercase text-zinc-500 mb-2">Antecedentes</h4>{(!selectedItem.historico_criminal || selectedItem.historico_criminal.length === 0) && <p className="text-xs text-zinc-300">Nenhum registro.</p>}{selectedItem.historico_criminal?.map((h, i) => (<div key={i} className="text-xs border-l-2 border-zinc-800 pl-2 mb-2"><span className="font-bold block uppercase">{h.artigo}</span><span className="text-[10px] text-zinc-500">{h.tipo} • {h.data}</span></div>))}</div></div></div></div>)}</div>);
            if (mode === 'car') return (<div className="space-y-4 animate-fade-in relative">{deleteConfirm && (<div className="absolute inset-0 z-50 bg-white/90 flex items-center justify-center p-4"><div className="bg-white border-2 border-red-500 p-6 rounded-xl shadow-xl text-center"><h4 className="font-black text-red-600 uppercase mb-2">Apagar Veículo?</h4><div className="flex gap-2"><button onClick={() => setDeleteConfirm(null)} className="flex-1 bg-zinc-200 py-2 rounded text-xs font-bold uppercase">Cancelar</button><button onClick={handleDelete} className="flex-1 bg-red-600 text-white py-2 rounded text-xs font-bold uppercase">Apagar</button></div></div></div>)}<div className="flex items-center justify-between"><h3 className="font-bold uppercase text-zinc-500 text-xs">Consulta Veicular</h3><button onClick={() => {setMode('menu'); setResult(null); setTerm('');}} className="text-zinc-400 bg-white p-1 rounded-full border"><X size={16}/></button></div><form onSubmit={searchCar} className="bg-white p-2 rounded-xl shadow-sm border border-zinc-200 flex items-center"><Search size={20} className="text-zinc-400 ml-3" /><input value={term} onChange={e=>setTerm(e.target.value)} className="flex-1 bg-transparent p-3 outline-none text-zinc-800 placeholder-zinc-400 font-medium uppercase" placeholder="PLACA (XXX-0000)" autoFocus /><button className="bg-black text-white px-4 py-2 rounded-lg text-xs font-bold uppercase">{loading ? '...' : 'BUSCAR'}</button></form>{result === 'NOT_FOUND' && <div className="text-center text-zinc-400 text-sm py-10">Veículo não encontrado.</div>}{result && result !== 'NOT_FOUND' && (<div className="bg-white p-6 rounded-2xl shadow-md border-t-8 border-blue-600 animate-slide-up relative"><button onClick={() => setDeleteConfirm({col: 'veiculos', id: result.id})} className="absolute top-2 right-2 text-zinc-300 hover:text-red-500"><Trash2 size={18}/></button><h2 className="text-3xl font-black text-zinc-900 uppercase tracking-tighter">{result.placa}</h2><p className="text-sm font-bold text-zinc-500 uppercase mb-4">{result.modelo} • {result.cor}</p><div className="bg-zinc-50 p-3 rounded-lg border border-zinc-100"><span className="text-[10px] font-bold text-zinc-400 uppercase">Proprietário</span><p className="font-bold text-zinc-800 uppercase text-lg">{result.proprietario}</p></div><div className="mt-4 flex gap-2"><button className="flex-1 bg-yellow-400 text-black py-3 rounded-lg font-bold uppercase text-xs">Apreender</button><button className="flex-1 bg-zinc-800 text-white py-3 rounded-lg font-bold uppercase text-xs">Multar</button></div></div>)}</div>);
            return null;
        };

        const AdminPanel = ({ db, onExit }) => {
            const [tab, setTab] = useState('new'); 
            const [newName, setNewName] = useState('');
            const [newRank, setNewRank] = useState('Recruta');
            const [maspGerado, setMaspGerado] = useState('');
            const [officers, setOfficers] = useState([]);
            const [wiping, setWiping] = useState(false);
            const [deleteOfficerId, setDeleteOfficerId] = useState(null);
            const [showWipeConfirm, setShowWipeConfirm] = useState(false);

            useEffect(() => {
                if (tab === 'manage') {
                    const q = query(collection(db, "policiais"), orderBy("nome"));
                    const unsub = onSnapshot(q, (snap) => setOfficers(snap.docs.map(d => ({id: d.id, ...d.data()}))));
                    return () => unsub();
                }
            }, [db, tab]);

            useEffect(() => {
                if(tab === 'new') setMaspGerado(Math.floor(100000 + Math.random() * 900000).toString());
            }, [tab]);

            const createOfficer = async () => {
                if(!newName) return alert("Preencha o nome");
                await addDoc(collection(db, "policiais"), {
                    nome: newName.toUpperCase(), masp: maspGerado, cargo: newRank, createdAt: serverTimestamp()
                });
                alert(`Oficial Cadastrado!\nMASP: ${maspGerado}`);
                setNewName(''); setMaspGerado(Math.floor(100000 + Math.random() * 900000).toString());
            };

            const executeDeleteOfficer = async () => {
                if(deleteOfficerId) {
                    await deleteDoc(doc(db, "policiais", deleteOfficerId));
                    setDeleteOfficerId(null);
                }
            };

            const updateRank = async (id, currentRank, direction) => {
                const currentIndex = PATENTES.indexOf(currentRank);
                let newIndex = direction === 'up' ? currentIndex + 1 : currentIndex - 1;
                if (newIndex >= 0 && newIndex < PATENTES.length) await updateDoc(doc(db, "policiais", id), { cargo: PATENTES[newIndex] });
            };

            const executeWipe = async () => {
                setWiping(true);
                try {
                    const collections = ["cidadaos", "veiculos", "reds", "tcos", "boletins"];
                    for (const colName of collections) {
                        const q = query(collection(db, colName));
                        const snap = await getDocs(q);
                        const batch = writeBatch(db);
                        snap.docs.forEach(doc => batch.delete(doc.ref));
                        await batch.commit();
                    }
                    alert("LIMPEZA CONCLUÍDA.");
                } catch (e) { alert("Erro: " + e.message); }
                setWiping(false);
                setShowWipeConfirm(false);
            };

            return (
                <div className="min-h-screen bg-zinc-100 font-sans flex flex-col relative">
                    {deleteOfficerId && (<div className="absolute inset-0 z-50 bg-black/90 flex items-center justify-center p-6"><div className="bg-zinc-900 border border-red-600 p-6 rounded-xl w-full max-w-xs text-center shadow-2xl"><h3 className="text-white font-black uppercase text-lg mb-2">Confirmar Exoneração</h3><div className="flex gap-2"><button onClick={() => setDeleteOfficerId(null)} className="flex-1 bg-zinc-700 text-white py-3 rounded font-bold uppercase text-xs">Cancelar</button><button onClick={executeDeleteOfficer} className="flex-1 bg-red-600 text-white py-3 rounded font-bold uppercase text-xs">Confirmar</button></div></div></div>)}
                    {showWipeConfirm && (<div className="absolute inset-0 z-50 bg-red-900/95 flex items-center justify-center p-6"><div className="bg-white p-6 rounded-xl w-full max-w-sm text-center shadow-2xl"><h3 className="text-red-900 font-black uppercase text-xl mb-2">Perigo: Limpeza Total</h3><p className="text-zinc-600 text-sm mb-6">Isso apagará TODOS os registros.</p><div className="flex gap-2"><button onClick={() => setShowWipeConfirm(false)} className="flex-1 bg-zinc-200 text-zinc-700 py-3 rounded font-bold uppercase text-xs">Cancelar</button><button onClick={executeWipe} disabled={wiping} className="flex-1 bg-red-600 text-white py-3 rounded font-bold uppercase text-xs">{wiping ? "Apagando..." : "Confirmar"}</button></div></div></div>)}
                    <div className="bg-zinc-900 text-white p-4 flex justify-between items-center shadow-lg border-b-4 border-red-700"><h2 className="font-black uppercase flex items-center"><Shield className="mr-2 text-red-600"/> Painel Administrativo</h2><button onClick={onExit} className="text-xs font-bold uppercase bg-red-900 px-3 py-1 rounded hover:bg-red-800">Sair</button></div>
                    <div className="flex bg-white border-b border-zinc-200"><button onClick={() => setTab('new')} className={`flex-1 py-4 text-xs font-black uppercase border-b-2 transition-colors ${tab === 'new' ? 'border-red-600 text-red-700' : 'border-transparent text-zinc-400'}`}>Novo Oficial</button><button onClick={() => setTab('manage')} className={`flex-1 py-4 text-xs font-black uppercase border-b-2 transition-colors ${tab === 'manage' ? 'border-red-600 text-red-700' : 'border-transparent text-zinc-400'}`}>Gerenciar</button><button onClick={() => setTab('system')} className={`flex-1 py-4 text-xs font-black uppercase border-b-2 transition-colors ${tab === 'system' ? 'border-red-600 text-red-700' : 'border-transparent text-zinc-400'}`}>Sistema</button></div>
                    <div className="flex-1 p-6 overflow-y-auto">
                        {tab === 'new' && (<div className="max-w-md mx-auto bg-white p-6 rounded-xl shadow-sm space-y-4"><div className="bg-zinc-100 p-4 rounded-lg text-center border border-zinc-200"><span className="text-[10px] font-bold text-zinc-500 uppercase">MASP Gerado</span><p className="text-3xl font-mono font-black text-zinc-900 tracking-widest">{maspGerado}</p></div><input value={newName} onChange={e=>setNewName(e.target.value)} className="w-full p-3 bg-zinc-50 border border-zinc-200 rounded uppercase font-bold text-sm" placeholder="Ex: SD. SILVA" /><select value={newRank} onChange={e=>setNewRank(e.target.value)} className="w-full p-3 bg-zinc-50 border border-zinc-200 rounded uppercase font-bold text-sm">{PATENTES.map(p => <option key={p} value={p}>{p}</option>)}</select><button onClick={createOfficer} className="w-full bg-black text-white py-4 rounded-xl font-black uppercase shadow-lg hover:bg-zinc-800">Confirmar Cadastro</button></div>)}
                        {tab === 'manage' && (<div className="max-w-2xl mx-auto space-y-3">{officers.map(off => (<div key={off.id} className="bg-white p-4 rounded-xl shadow-sm border border-zinc-200 flex justify-between items-center"><div><h4 className="font-black text-zinc-800 uppercase">{off.nome}</h4><p className="text-xs text-zinc-500 font-bold uppercase">{off.cargo} • MASP: {off.masp}</p></div><div className="flex items-center space-x-2"><div className="flex flex-col space-y-1"><button onClick={() => updateRank(off.id, off.cargo, 'up')} className="p-1 bg-zinc-100 rounded hover:bg-green-100 text-green-700"><ChevronUp size={16}/></button><button onClick={() => updateRank(off.id, off.cargo, 'down')} className="p-1 bg-zinc-100 rounded hover:bg-yellow-100 text-yellow-700"><ChevronDown size={16}/></button></div><button onClick={() => setDeleteOfficerId(off.id)} className="p-3 bg-red-50 text-red-700 rounded-lg hover:bg-red-100 ml-2"><Trash2 size={20} /></button></div></div>))}</div>)}
                        {tab === 'system' && (<div className="max-w-md mx-auto bg-red-50 border-2 border-red-200 p-6 rounded-xl text-center space-y-4"><h3 className="font-black text-red-800 uppercase text-xl">Resetar Operação</h3><button onClick={() => setShowWipeConfirm(true)} className="w-full bg-red-700 text-white py-4 rounded-xl font-black uppercase shadow-lg hover:bg-red-800 disabled:opacity-50">{wiping ? "Limpando..." : "EXECUTAR LIMPEZA GERAL"}</button></div>)}
                    </div>
                </div>
            );
        };

        const AppLayout = ({ user, onLogout, db }) => {
            const [activeTab, setActiveTab] = useState('home');
            const [modalData, setModalData] = useState(null);
            const closeModal = () => setModalData(null);

            return (
                <div className="min-h-screen bg-zinc-100 font-sans pb-24">
                    <header className="bg-black text-white pt-12 pb-6 px-5 rounded-b-3xl shadow-xl sticky top-0 z-30">
                        <div className="flex justify-between items-center mb-4">
                            <div className="flex items-center space-x-3"><img src={LOGO_URL} alt="Logo" className="w-8 h-auto" /><div><h2 className="font-bold text-sm leading-none uppercase text-white">PCMG<span className="text-red-600">net</span></h2><p className="text-[8px] text-zinc-400 uppercase tracking-wide mt-1">1ª Delegacia Integrada</p></div></div>
                            <div className="flex items-center"><div className="text-right mr-3"><p className="text-[10px] font-bold text-white uppercase">{user.nome}</p><p className="text-[8px] text-zinc-500 uppercase">{user.cargo}</p></div><button onClick={onLogout} className="p-2 bg-zinc-900 rounded-full text-zinc-300 hover:text-red-500 transition-colors"><LogOut size={16}/></button></div>
                        </div>
                    </header>
                    <main className="px-4 py-6 animate-fade-in">
                        {activeTab === 'home' && <HomeView db={db} openDetails={setModalData} onNavigate={setActiveTab} />}
                        {activeTab === 'ops' && <OperationalView db={db} user={user} onSuccess={() => setActiveTab('home')} />}
                        {activeTab === 'search' && <SearchView db={db} />}
                        {activeTab === 'reds' && <RedsView db={db} user={user} onSuccess={() => setActiveTab('home')} />}
                        {activeTab === 'tco' && <TcoView db={db} user={user} onSuccess={() => setActiveTab('home')} />}
                        {activeTab === 'tools' && <ToolsView db={db} user={user} onNavigate={setActiveTab} />}
                        {activeTab === 'jecrim' && <JecrimView db={db} openDetails={setModalData} onBack={() => setActiveTab('home')} />}
                    </main>
                    {modalData && <DetailModal data={modalData} onClose={closeModal} db={db} user={user} />}
                    <nav className="fixed bottom-0 w-full bg-white border-t border-zinc-200 px-6 py-3 flex justify-between items-center z-40 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)]">
                        <NavButton icon={<Home size={24} />} label="Início" active={activeTab === 'home'} onClick={() => setActiveTab('home')} />
                        <NavButton icon={<Siren size={24} />} label="Operacional" active={activeTab === 'ops'} onClick={() => setActiveTab('ops')} />
                        <div className="relative -top-8"><button onClick={() => setActiveTab('reds')} className={`w-16 h-16 rounded-full flex items-center justify-center shadow-lg shadow-red-700/40 transition-transform active:scale-95 ${activeTab === 'reds' ? 'bg-zinc-900 text-white' : 'bg-red-700 text-white'} border-4 border-zinc-100`}><Plus size={32} /></button></div>
                        <NavButton icon={<Search size={24} />} label="Investigar" active={activeTab === 'search'} onClick={() => setActiveTab('search')} />
                        <NavButton icon={<Menu size={24} />} label="Ferramentas" active={activeTab === 'tools'} onClick={() => setActiveTab('tools')} />
                    </nav>
                </div>
            );
        };

        const LoginScreen = ({ onLogin, db }) => {
            const [masp, setMasp] = useState('');
            const [adminMode, setAdminMode] = useState(false); 
            const [adminPassInput, setAdminPassInput] = useState('');
            const [isAdminAuthenticated, setIsAdminAuthenticated] = useState(false);
            const handleLogin = async (e) => { e.preventDefault(); try { const q = query(collection(db, "policiais"), where("masp", "==", masp)); const snap = await getDocs(q); if (!snap.empty) onLogin(snap.docs[0].data()); else alert("Policial não encontrado."); } catch (err) { alert("Erro de conexão"); } };
            const verifyAdmin = (e) => { e.preventDefault(); if(adminPassInput === ADMIN_PASS) setIsAdminAuthenticated(true); else alert("SENHA MESTRA INCORRETA"); };
            if (adminMode) { if (!isAdminAuthenticated) return (<div className="min-h-screen bg-black flex flex-col items-center justify-center p-6 text-white"><div className="bg-zinc-900 p-8 rounded-xl border border-red-900 w-full max-w-sm text-center"><Shield size={48} className="mx-auto text-red-600 mb-4" /><h3 className="font-black uppercase text-xl mb-6">Acesso do Comandante</h3><form onSubmit={verifyAdmin} className="space-y-4"><input type="password" value={adminPassInput} onChange={e=>setAdminPassInput(e.target.value)} className="w-full bg-black border border-zinc-700 p-3 rounded text-white text-center tracking-widest font-bold outline-none focus:border-red-600" placeholder="SENHA ADMINISTRATIVA" /><button className="w-full bg-white text-black font-bold py-3 rounded uppercase hover:bg-gray-200">Acessar Painel</button></form><button onClick={() => setAdminMode(false)} className="mt-6 text-zinc-500 text-xs uppercase hover:text-white">Voltar ao Login</button></div></div>); return <AdminPanel db={db} onExit={() => { setIsAdminAuthenticated(false); setAdminMode(false); }} />; }
            return (<div className="min-h-screen bg-zinc-950 flex flex-col items-center justify-center p-6 font-sans relative overflow-hidden"><div className="absolute inset-0 bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-red-900 via-zinc-950 to-black opacity-40"></div><div className="z-10 w-full max-w-xs flex flex-col items-center space-y-8 animate-fade-in"><div className="relative"><div className="absolute -inset-4 bg-red-600/20 blur-xl rounded-full"></div><img src={LOGO_URL} alt="Brasão" className="w-32 h-auto drop-shadow-2xl relative z-10" /></div><div className="text-center space-y-1"><h1 className="text-3xl font-black text-white tracking-tighter">PCMG<span className="text-red-600">net</span></h1><p className="text-zinc-500 text-[10px] font-bold uppercase tracking-widest max-w-[200px] mx-auto leading-tight">1ª Delegacia Territorial Integrada de MadOut2</p></div><form onSubmit={handleLogin} className="w-full space-y-4"><input value={masp} onChange={e => setMasp(e.target.value)} className="w-full bg-zinc-900 border border-zinc-800 rounded-xl text-white p-4 text-center font-bold tracking-widest placeholder-zinc-600 outline-none focus:border-red-600 transition-colors" placeholder="DIGITE SEU MASP" inputMode="numeric"/><button className="w-full bg-red-800 hover:bg-red-700 text-white font-bold py-4 rounded-xl shadow-lg text-sm uppercase tracking-wider border border-red-900">ENTRAR NO SISTEMA</button></form><button onClick={() => setAdminMode(true)} className="flex items-center text-zinc-600 text-xs font-bold uppercase hover:text-white transition-colors"><Settings size={14} className="mr-2" /> Acesso do Comandante (Admin)</button></div></div>);
        };

        const GOVSystem = () => {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);
            useEffect(() => { signInAnonymously(auth).then(() => setLoading(false)); }, []);
            if (loading) return <div className="h-screen bg-black flex items-center justify-center text-white font-bold animate-pulse">CONECTANDO PCMGnet...</div>;
            if (!user) return <LoginScreen onLogin={setUser} db={db} />;
            return <AppLayout user={user} onLogout={() => setUser(null)} db={db} />;
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<GOVSystem />);
    </script>
</body>
</html>
    
  </body>
  
</html>
